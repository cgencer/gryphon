<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />

<title>MAKINA</title>


<script type="text/javascript" src="https://www.google.com/jsapi" charset="utf-8" ></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js" charset="utf-8" ></script>



<script type="text/javascript" src="widget.js" charset="utf-8" ></script>



<script>

    // Load the Visualization API and the piechart package.
    google.load('visualization', '1.0', {
        'packages':[
            'corechart',
            'table',
            'geochart'
        ]});

    //  var vsz = google.visualization;



    var fetchCallBackGroupBy = function(response){

        console.log("fetchCallBackGroupBy++++++++++++++");
        console.log(response);
        drawGeoMap(response.response);


    }

    var fetchCallBackSum = function(response){

        console.log("fetchCallBackSum++++++++++++++");
        console.log(response);

    }

    var responseSuccessCallBack = function(response){
        console.log(" JSONP responseSuccessCallBack");
    }


    var responseErrorCallBack = function(response){
        console.log(" JSONP responseErrorCallBack")
    }

    var fetchCallBackGroupBy2 = function(response){

    }



    function drawGeoMap(arr){


        var chart = new google.visualization.GeoChart(document.getElementById("content-widget"));

        var data =[ ['Country', 'Click'] ];


        for(var i in arr){

            var item = arr[i];
            if(item["CountryCode"]=="TR"){

                var city = item["City"];
                var click = 0;
                if(item["timeslotCLICK"]!= undefined)
                    click =item["timeslotCLICK"]["c"];
                if(isNaN(click))
                    click =0;

                var dataItem =[city,click]
                data.push(dataItem);
            }

        }



        var options = {
            region: 'TR',
            displayMode: 'markers',
            colorAxis: {colors: ['green', 'blue']}
        };

        var dataTable = google.visualization.arrayToDataTable(data);
        chart.draw(dataTable, options);

    }








    $(document).ready(function(){


        $("#create-widget").click(function(){


            var options={
                "url":"http://makina.nmdapps.com/Events/Report/MAKINA/CIRawReport",
                "refreshTime":20,
                "fetchOptions":[
                    {
                        "type":"sum", // sum, group by
                        "name":"fetch 1",
                        "byColumns":[], // group bys
                        "columns":['timeslotCLICK','timeslotINSTALL'],// city,app,company
                        "fetchCallBack": fetchCallBackSum
                    },
                    {
                        "type":"groupby", // sum, group by
                        "name":"fetch 2",
                        "byColumns":['CountryCode','City'], // group bys
                        "columns":['timeslotCLICK','timeslotINSTALL'],// city,app,company
                        "fetchCallBack": fetchCallBackGroupBy
                    },
                    {
                        "type":"groupby", // sum, group by
                        "name":"fetch 3",
                        "byColumns":['CountryCode'], // group bys
                        "columns":['timeslotCLICK','timeslotINSTALL'],// city,app,company
                        "fetchCallBack": fetchCallBackGroupBy2
                    }

                ],
                "responseSuccessCallBack" : responseSuccessCallBack,
                "responseErrorCallBack": responseErrorCallBack
            };



            var widget1 =  new HandsomeWidget(options,"widget-console");

            console.log("widget1");
            console.log(widget1);

        });




    });








</script>



</head>
<body>


<div id="content">


    <input type="button" id="create-widget" value="Create Widget" />

    <table style="height: 500px;">
        <tr>
            <td valign="top"> <div id="content-widget" style="width: 400px;height: 200px;" ></div></td>
            <td valign="top"><div id="widget-console"></div></td>
        </tr>
    </table>



    <div id="chart_div"></div>




</div>





</body>
</html>